<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Baurum Radio - –ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="/icon-192.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Theme Color -->
    <meta name="theme-color" content="#4A00E0">

    <!-- Mobile Web App Capable -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Baurum Radio">

    <!-- Base URL -->
    <base href="https://baurumcoin.com/">
  </head>
  <body>
    <div id="root"></div>
    
    <!-- –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É API -->
    <div id="api-status" style="display: none; position: fixed; top: 10px; right: 10px; background: #ff4444; color: white; padding: 10px; border-radius: 5px; z-index: 9999;">
      API —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    </div>

    <script type="module" src="/src/main.jsx"></script>
    
    <script>
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ WebGL
      window.addEventListener('error', function(e) {
        if (e.message.includes('WebGL') || e.filename.includes('webgl')) {
          console.warn('WebGL error caught:', e.message);
          e.preventDefault();
        }
      });

      // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º WebGL –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
      if (typeof WebGLRenderingContext !== 'undefined') {
        const originalGetContext = HTMLCanvasElement.prototype.getContext;
        HTMLCanvasElement.prototype.getContext = function() {
          try {
            return originalGetContext.apply(this, arguments);
          } catch (e) {
            console.warn('WebGL context failed, falling back to 2D');
            return null;
          }
        };
      }

      // –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ React
      function checkReactLoaded() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–≥—Ä—É–∑–∫–∏ React
        const reactLoaded = (
          typeof React !== 'undefined' ||
          typeof window.React !== 'undefined' ||
          document.querySelector('[data-reactroot]')
        );
        
        if (reactLoaded) {
          console.log('‚úÖ React loaded successfully');
          hideLoader();
          return true;
        }
        return false;
      }

      // –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
      let attempts = 0;
      const maxAttempts = 20;
      const checkInterval = setInterval(() => {
        attempts++;
        if (checkReactLoaded() || attempts >= maxAttempts) {
          clearInterval(checkInterval);
          if (attempts >= maxAttempts) {
            showReactError();
          }
        }
      }, 500);

      function showReactError() {
        console.error('‚ùå React failed to load after timeout');
        hideLoader();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        const errorDiv = document.createElement('div');
        errorDiv.innerHTML = `
          <div style="
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(0,0,0,0.9); 
            color: white; 
            padding: 30px; 
            border-radius: 15px;
            text-align: center;
            z-index: 10000;
            border: 2px solid #4A00E0;
            max-width: 80%;
          ">
            <h2 style="margin: 0 0 15px 0; color: #8A2BE2;">üö´ –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
            <p style="margin: 0 0 20px 0;">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <button onclick="window.location.reload()" style="padding: 10px; background: #4A00E0; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
              </button>
              <button onclick="clearCacheAndReload()" style="padding: 10px; background: #6A0DAD; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –æ–±–Ω–æ–≤–∏—Ç—å
              </button>
            </div>
          </div>
        `;
        document.body.appendChild(errorDiv);
      }

      function clearCacheAndReload() {
        // –ü—ã—Ç–∞–µ–º—Å—è –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
        if ('caches' in window) {
          caches.keys().then(function(names) {
            for (let name of names) caches.delete(name);
          });
        }
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
        window.location.reload(true);
      }

      function hideLoader() {
        const loading = document.getElementById('loading');
        if (loading) {
          loading.style.display = 'none';
        }
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener('load', async () => {
        try {
          const response = await fetch('https://baurum.onrender.com/api/player/status', {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json'
            }
          });
          
          if (response.ok) {
            console.log('‚úÖ API —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω');
          } else {
            showApiError();
          }
        } catch (error) {
          console.error('‚ùå API —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error);
          showApiError();
        }
      });

      function showApiError() {
        const statusEl = document.getElementById('api-status');
        if (statusEl) {
          statusEl.style.display = 'block';
          statusEl.textContent = 'API —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ python api_server.py';
        }
      }
    </script>
    
    <style>
      /* –£–±–∏—Ä–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–æ–∞–¥–µ—Ä Vite */
      #vite-dev-loading,
      .vite-dev-loading {
        display: none !important;
      }
      
      /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –±–µ–ª—ã–π —ç–∫—Ä–∞–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
      body {
        background-color: #000000 !important;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      
      /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å—ë –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è React */
      #root:empty {
        display: none;
      }
      
      /* –°—Ç–∏–ª–∏ –¥–ª—è –ª–æ–∞–¥–µ—Ä–∞ */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        font-family: Arial, sans-serif;
        z-index: 1000;
      }
      
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #333;
        border-top: 4px solid #4A00E0;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
    
    <!-- –õ–æ–∞–¥–µ—Ä –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="loading" class="loading-screen">
      <div class="spinner"></div>
      <div>–ó–∞–≥—Ä—É–∑–∫–∞ Baurum Radio...</div>
    </div>
    
    <script>
      // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä –∫–æ–≥–¥–∞ React –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
      window.addEventListener('DOMContentLoaded', () => {
        const root = document.getElementById('root');
        const loading = document.getElementById('loading');
        
        if (root && loading) {
          const observer = new MutationObserver((mutations) => {
            if (root.children.length > 0) {
              loading.style.display = 'none';
              observer.disconnect();
            }
          });
          
          observer.observe(root, { childList: true });
        }
      });
    </script>
  </body>
</html>